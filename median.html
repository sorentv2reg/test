<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focused Median.io Debug Page</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
        h1 { color: #333; }
        #debug-output { background-color: #f4f4f4; border: 1px solid #ddd; padding: 10px; margin-top: 20px; }
        .key-info { font-weight: bold; color: #0066cc; }
        .highlight { background-color: yellow; padding: 2px 5px; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Focused Median.io Debug Page</h1>
    <button onclick="refreshDebugInfo()">Refresh Debug Info</button>
    <div id="debug-output"></div>

    <script>
    const DAYS_TO_EXPIRE_COOKIE = 365;
    let appResumeCallCount = 0;
    let lastAppResumeTime = null;

    function debugLog(message) {
        const debugOutput = document.getElementById('debug-output');
        debugOutput.innerHTML += message + '<br>';
        console.log(message);
    }

    function clearDebugOutput() {
        document.getElementById('debug-output').innerHTML = '';
    }

    function median_get_cookie(name) {
        const nameEQ = `${name}=`;
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i].trim();
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length);
        }
        return null;
    }

    function median_set_cookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = `${name}=${value || ""}${expires}; path=/`;
    }

    function median_set_active() {
        const timestamp = new Date().getTime();
        median_set_cookie('medianactive', timestamp, DAYS_TO_EXPIRE_COOKIE);
    }

    function median_is_active_expired() {
        const timestamp = median_get_cookie('medianactive');
        if (!timestamp) return true;
        const currentTime = new Date().getTime();
        const elapsedTime = (currentTime - parseInt(timestamp, 10)) / 1000;
        return elapsedTime > 10;
    }

    function median_app_resumed() {
        appResumeCallCount++;
        lastAppResumeTime = new Date();
        debugLog('<span class="highlight">median_app_resumed called</span>');
        if (median_is_active_expired()) {
            debugLog('<span class="key-info">Page would be reloaded due to expired median_active</span>');
            // Commented out to prevent actual reload
            // window.location.reload();
        } else {
            debugLog('<span class="key-info">Page would NOT be reloaded (median_active not expired)</span>');
        }
        median_set_active();
        refreshDebugInfo();
    }

    function refreshDebugInfo() {
        clearDebugOutput();
        debugLog('<span class="key-info">1. App Resume Status:</span>');
        debugLog('   • Has median_app_resumed been called? <span class="highlight">' + (appResumeCallCount > 0 ? 'YES' : 'NO') + '</span>');
        debugLog('   • Number of times called: <span class="highlight">' + appResumeCallCount + '</span>');
        if (lastAppResumeTime) {
            debugLog('   • Last called at: <span class="highlight">' + lastAppResumeTime.toLocaleString() + '</span>');
        }
        
        debugLog('<span class="key-info">2. Page Reload Status:</span>');
        const lastActiveTimestamp = parseInt(median_get_cookie('medianactive') || '0', 10);
        const timeSinceLastActive = (new Date().getTime() - lastActiveTimestamp) / 1000;
        debugLog('   • Time since last active: ' + timeSinceLastActive.toFixed(2) + ' seconds');
        debugLog('   • Is active expired (> 10 seconds): ' + median_is_active_expired());
        debugLog('   • ' + (median_is_active_expired() ? 'Page WOULD be reloaded if median_app_resumed is called now' : 'Page would NOT be reloaded if median_app_resumed is called now'));
    }

    // Initial setup
    refreshDebugInfo();

    // Override median functions to add logging
    if (typeof median !== 'undefined') {
        const originalAppResumed = median.app_resumed;
        median.app_resumed = function() {
            median_app_resumed();
            if (originalAppResumed) originalAppResumed();
        };
    } else {
        debugLog('Median object not found. This page may not be running in a Median environment.');
    }
    </script>
</body>
</html>
